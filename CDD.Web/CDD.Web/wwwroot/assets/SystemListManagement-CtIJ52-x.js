import{m as z,I as se,q as O,d as ae,r as ne,s as M,b as oe,w as j,c as b,f as t,x as U,h as k,t as i,y as H,g as re,v as ie,z as o,n as f,F as _,A as R,B as V,H as $,k as E,e as d,R as de,T as ue,D as T,E as I,S as ce,J as A,K as g,M as G,_ as pe}from"./index-tYXX4zXZ.js";import{_ as W}from"./Pagination.vue_vue_type_script_setup_true_lang-CTE3-Uu0.js";import{J as Y}from"./JsonFormModal-D_HC101j.js";import{C as y}from"./index-Cu1epPna.js";const me=()=>({modalId:"myModal",title:"新增介接系統",showModal:!1,size:"modal-xl",staticBackdrop:!0,fieldGroups:[{title:"",gridClass:"col-12  ",fields:[{modelId:"system",name:"system",type:"text",label:"系統代號(識別)",placeholder:"系統代號",required:!0,maxlength:10,onInputCallback:s=>z(s),onSubmitCheckCallback:s=>s?s.length>10?"系統代號(識別)長度不能超過10個字元":"":"系統代號(識別)為必填欄位"},{modelId:"apiKey",name:"apiKey",type:"text",label:"ApiKey",hint:"(格式為UUID 選填，若空則系統自動產生)",maxlength:36,required:!1,onInputCallback:s=>z(s),onSubmitCheckCallback:s=>s&&s.length>36?"ApiKey長度不能超過36個字元":s&&!se(s)?"ApiKey格式錯誤，應為UUID格式":""},{modelId:"isActive",name:"isActive",type:"radio",label:"是否啟用",inline:!0,options:[{label:"啟用",value:"Y"},{label:"停用",value:"N"}],required:!0}]}]}),ye=()=>({system:"",apiKey:null,isActive:"Y"}),be=()=>({modalId:"GenTokenModal",title:"產生 X-Source",showModal:!1,size:"modal-xl",staticBackdrop:!0,scrollable:!0,fieldGroups:[{title:"",gridClass:"col-6  ",fields:[{modelId:"source_id",name:"source_id",type:"text",label:"source_id 系統代號(識別)",placeholder:"system",required:!0,maxlength:10,onInputCallback:s=>{console.log(123)}},{modelId:"time",name:"time",type:"text",label:"time",hint:"(yyyy/MM/dd HH:mm:ss)",maxlength:19,required:!1,onChangeCallback:s=>{s||(s=D())}},{modelId:"AES_key",name:"AES_key",type:"text",label:"AES_key(即ApiKey)",hint:"(ApiKey格式為UUID)",maxlength:36,required:!0}]},{title:"",gridClass:"col-6  ",fields:[{modelId:"hash",name:"hash",type:"text",label:"HashKey",placeholder:"HashKey",required:!0,maxlength:32,onInputCallback:s=>{console.log(123)}},{modelId:"iv",name:"iv",type:"text",label:"IVKey",placeholder:"IVKey",required:!0,maxlength:16,onInputCallback:s=>{console.log(123)}}]},{title:"",gridClass:"col-12  ",fields:[{modelId:"encrypted_source",name:"Encrypted Source",type:"textarea",label:"Encrypted",placeholder:"Encrypted",required:!1,disabled:!0,maxlength:1e3,rows:5,onInputCallback:s=>{console.log(123)}},{modelId:"decrypted_source",name:"Decrypted Source",type:"textarea",label:"Decrypted",placeholder:"Decrypted",required:!1,disabled:!0,maxlength:1e3,rows:5,onInputCallback:s=>{console.log(123)}}]}]}),X=()=>({source_id:"",time:D(),AES_key:"",hash:"",iv:"",encrypted_source:"",decrypted_source:""});function D(){const s=new Date,a=B=>B.toString().padStart(2,"0"),u=s.getFullYear(),p=a(s.getMonth()+1),r=a(s.getDate()),m=a(s.getHours()),h=a(s.getMinutes()),w=a(s.getSeconds());return"".concat(u,"/").concat(p,"/").concat(r," ").concat(m,":").concat(h,":").concat(w)}function N(s,a){switch(a){case"utf8":return y.enc.Utf8.parse(s);case"hex":return y.enc.Hex.parse(s);case"base64":return y.enc.Base64.parse(s);default:throw new Error("Unsupported encoding type.")}}function ge(s,a,u,p="utf8"){const r=N(a,p),m=N(u,p);if(![16,24,32].includes(r.sigBytes))throw new Error("Invalid AES key size: ".concat(r.sigBytes," bytes"));if(m.sigBytes!==16)throw new Error("IV must be 16 bytes, got ".concat(m.sigBytes," bytes"));const h=JSON.stringify(s);return y.AES.encrypt(h,r,{iv:m,mode:y.mode.CBC,padding:y.pad.Pkcs7}).toString()}function fe(s,a,u,p="utf8"){const r=N(a,p),m=N(u,p);if(![16,24,32].includes(r.sigBytes))throw new Error("Invalid AES key size: ".concat(r.sigBytes," bytes"));if(m.sigBytes!==16)throw new Error("IV must be 16 bytes, got ".concat(m.sigBytes," bytes"));const w=y.AES.decrypt(s,r,{iv:m,mode:y.mode.CBC,padding:y.pad.Pkcs7}).toString(y.enc.Utf8);return JSON.parse(w)}const he=()=>({modalId:"sysUpdateModal",title:"修改介接系統",showModal:!1,size:"modal-xl",staticBackdrop:!0,fieldGroups:[{title:"",gridClass:"col-12  ",fields:[{modelId:"system",name:"system",type:"text",label:"系統代號(識別)",placeholder:"系統代號",required:!0,maxlength:10,onInputCallback:s=>s=z(s)},{modelId:"apiKey",name:"apiKey",type:"text",label:"ApiKey",hint:"(格式為UUID 選填，若空則系統自動產生)",maxlength:36,required:!1,onInputCallback:s=>{s=z(s)}},{modelId:"hashKey",name:"hashKey",type:"text",label:"hashKey",hint:"",maxlength:36,required:!1,onInputCallback:s=>{s=O(s)}},{modelId:"iVKey",name:"iVKey",type:"text",label:"iVKey",hint:" ",maxlength:16,required:!1,onInputCallback:s=>{s=O(s)}},{modelId:"isActive",name:"isActive",type:"radio",label:"是否啟用",inline:!0,options:[{label:"啟用",value:"Y"},{label:"停用",value:"N"}],required:!0}]}]}),ve={class:"p-4 mt-5"},ke={class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},we={class:"h2"},Se={class:"btn-toolbar justify-content-end mb-3",role:"toolbar","aria-label":"Toolbar with button groups"},Ce={class:"btn-group me-2",role:"group","aria-label":"First group"},xe={class:"input-group ms-3",style:{"max-width":"200px"}},Me={class:"btn-group",role:"group"},Ie={class:"card card-esun h-100 esun-animate-in"},Ae={class:"card-body"},Ke={class:"card-title"},Ue={class:"card-text"},Ve={class:"dropdown mt-3"},$e={class:"dropdown-menu w-100"},Ee=["onClick"],Te={key:0},ze=["onClick"],De=["onClick"],Ne={class:"table table-bordered table-hover align-middle"},Be={class:"dropdown mt-3"},qe={class:"dropdown-menu w-100"},Pe=["onClick"],He={key:0},Ge=["onClick"],Ye=["onClick"],Fe=ae({__name:"SystemListManagement",props:{collapsed:{type:Boolean},paginationType:{}},emits:["toggleTheme"],setup(s){const a=ne({systems:[],searchQuery:"",pageNumber:1,pageSize:10,totalItems:0,displayMode:"card",paginationType:"client"}),u=M(me()),p=M(ye()),r=async()=>{var n;try{const e=await V.SystemListManagementViewData(a.searchQuery,a.pageNumber,a.pageSize);e.status&&((n=e.result)!=null&&n.items)?(a.systems=e.result.items,a.totalItems=e.result.totalCount):$(e)}catch(e){console.error("Error fetching systems:",e),E(e)}finally{}};oe(async()=>{await r()}),j(()=>({pageNumber:a.pageNumber,pageSize:a.pageSize}),()=>{r()});const h=ue(async()=>{a.searchQuery&&await r()},100);j(()=>({searchQuery:a.searchQuery}),()=>{a.pageNumber=1});const w=()=>{a.searchQuery="",r()};function B(){u.value.showModal=!0}async function Z(n){try{u.value.showModal=!1;const e=n;if((await x.showAlert(A.Warning,"警告","確定要新增系統 ".concat(n.system," 嗎？"),[{id:"cancel",type:g.callback,btnClass:"btn-esun-outline ",resolveParam:"cancel",title:"取消"},{id:"confirm",type:g.callback,btnClass:"btn-info",resolveParam:"confirm",title:"確定"}])).param==="confirm"){alert("更新資料：\n"+JSON.stringify(n,null,2));const c=await V.SystemListManagementCreate(e);c.status?x.showAlert(A.Success,"成功","系統 ".concat(e.system," 已新增。"),[{id:"ok",type:g.callback,btnClass:"btn-info",resolveParam:"ok",title:"確定"}],G.lg).then(async()=>{await r()}):$(c)}u.value.showModal=!1}catch(e){E(e),console.error("Error fetching business:",e)}}const S=M(be()),C=M(X());function ee(){S.value.showModal=!0,C.value=X()}function te(n){try{if(!n)throw new Error("Form data is required");const e=n;e.time||(e.time=D());const l=e.hash,c=e.iv,v={source_id:e.source_id,time:e.time,AES_key:e.AES_key},P=ge(v,l,c,"utf8");console.log("Encrypted:",P),C.value.encrypted_source=P;const Q=fe(P,l,c,"utf8");console.log("Decrypted:",Q),C.value.decrypted_source=JSON.stringify(Q,null,2),S.value.showModal=!0}catch(e){E(e)}}const x=new ce,K=M(he()),q=M({system:"",apiKey:"",hashKey:"",iVKey:"",isActive:"",createdTime:"",lastUpdate:""});function F(n){q.value={...n},K.value.showModal=!0}async function le(n){try{const e=n;if((await x.showAlert(A.Warning,"警告","確定要更新系統 ".concat(n.system," 嗎？"),[{id:"cancel",type:g.callback,btnClass:"btn-esun-outline ",resolveParam:"cancel",title:"取消"},{id:"confirm",type:g.callback,btnClass:"btn-info",resolveParam:"confirm",title:"確定"}])).param==="confirm"){alert("更新資料：\n"+JSON.stringify(n,null,2));const c=await V.SystemListManagementUpdate(e);c.status?x.showAlert(A.Success,"成功","系統 ".concat(e.system," 已更新。"),[{id:"ok",type:g.callback,btnClass:"btn-info",resolveParam:"ok",title:"確定"}],G.lg).then(async()=>{await r()}):$(c)}K.value.showModal=!1}catch(e){E(e)}}async function J(n){if((await x.showAlert(A.Warning,"警告","確定要停用系統 ".concat(n.system," 嗎？"),[{id:"cancel",type:g.callback,btnClass:"btn-esun-outline ",resolveParam:"cancel",title:"取消"},{id:"confirm",type:g.callback,btnClass:"btn-info",resolveParam:"confirm",title:"確定"}])).param==="confirm"){const l=await V.SystemDeactivate(n.system);l.status?x.showAlert(A.Success,"成功","系統 ".concat(n.system," 已停用。"),[{id:"ok",type:g.callback,btnClass:"btn-info",resolveParam:"ok",title:"確定"}],G.lg).then(async()=>{await r()}):$(l)}}function L(n){S.value.showModal=!0,C.value={source_id:n.system,time:D(),AES_key:n.apiKey,hash:n.hashKey,iv:n.iVKey,encrypted_source:"",decrypted_source:""}}return(n,e)=>(d(),b("div",ve,[t("div",ke,[t("h1",we,i(H(de).SysManagement.label),1),t("div",Se,[t("div",Ce,[t("div",xe,[re(t("input",{type:"text",class:"form-control form-control-esun",placeholder:"搜尋系統...","onUpdate:modelValue":e[0]||(e[0]=l=>a.searchQuery=l)},null,512),[[ie,a.searchQuery]]),t("div",{class:"btn-close position-absolute end-0 top-50 translate-middle cursor-pointer shadow-none",onClick:w,"aria-label":"清除搜尋"},e[14]||(e[14]=[t("button",{class:"btn btn-link p-0","aria-label":"Close"},null,-1)]))]),t("button",{class:"btn btn-sm btn-esun-primary ml-3",onClick:e[1]||(e[1]=(...l)=>H(h)&&H(h)(...l))},e[15]||(e[15]=[t("i",{class:"bi bi-search me-1"},null,-1),o("搜尋 ")])),t("button",{class:"btn btn-sm btn-esun-outline ml-3",onClick:B},e[16]||(e[16]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),o("新增系統 ")])),t("button",{class:"btn btn-sm btn-esun-primary ml-3",onClick:ee},e[17]||(e[17]=[t("i",{class:"bi bi-key me-1"},null,-1),o("產生系統界接token ")]))]),u.value.showModal?(d(),U(Y,{key:0,myModal:u.value,modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l),onSubmit:Z,onCancel:e[3]||(e[3]=l=>u.value.showModal=!1)},null,8,["myModal","modelValue"])):k("",!0),S.value.showModal?(d(),U(Y,{key:1,myModal:S.value,modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=l=>C.value=l),onSubmit:te,onCancel:e[5]||(e[5]=l=>S.value.showModal=!1)},null,8,["myModal","modelValue"])):k("",!0),t("div",Me,[t("button",{class:f(["btn btn-sm btn-esun-outline",{active:a.displayMode==="card"}]),onClick:e[6]||(e[6]=l=>a.displayMode="card")},e[18]||(e[18]=[t("i",{class:"bi bi-grid-3x3-gap me-1"},null,-1),o("卡片模式 ")]),2),t("button",{class:f(["btn btn-sm btn-esun-outline",{active:a.displayMode==="table"}]),onClick:e[7]||(e[7]=l=>a.displayMode="table")},e[19]||(e[19]=[t("i",{class:"bi bi-table me-1"},null,-1),o("表格模式 ")]),2)])])]),a.totalItems?(d(),U(W,{key:0,modelValue:a.pageNumber,"onUpdate:modelValue":e[8]||(e[8]=l=>a.pageNumber=l),pageSize:a.pageSize,"onUpdate:pageSize":e[9]||(e[9]=l=>a.pageSize=l),"total-items":a.totalItems},null,8,["modelValue","pageSize","total-items"])):k("",!0),a.displayMode==="card"?(d(),b("div",{key:1,class:f(["row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 active",{"fade-in":a.pageNumber}]),ref:"dataContainer"},[(d(!0),b(_,null,R(a.systems,(l,c)=>(d(),b("div",{class:"col",key:"".concat(l.system,"-").concat(c)},[t("div",Ie,[t("div",Ae,[t("h5",Ke,i(l.system),1),t("p",Ue,[e[20]||(e[20]=t("strong",null,"ApiKey:",-1)),o(" "+i(l.apiKey),1),e[21]||(e[21]=t("br",null,null,-1)),e[22]||(e[22]=t("strong",null,"HashKey:",-1)),o(" "+i(l.hashKey),1),e[23]||(e[23]=t("br",null,null,-1)),e[24]||(e[24]=t("strong",null,"IVKey:",-1)),o(" "+i(l.iVKey),1),e[25]||(e[25]=t("br",null,null,-1)),e[26]||(e[26]=t("strong",null,"啟用狀態:",-1)),t("span",{class:f(l.isActive==="Y"?"text-success":"text-danger")},i(l.isActive==="Y"?"啟用中":"已停用"),3),e[27]||(e[27]=t("br",null,null,-1)),e[28]||(e[28]=t("strong",null,"建立時間:",-1)),o(" "+i(T(l.createdTime)),1),e[29]||(e[29]=t("br",null,null,-1)),e[30]||(e[30]=t("strong",null,"更新時間:",-1)),o(" "+i(T(l.lastUpdate)),1)]),t("div",Ve,[e[34]||(e[34]=t("button",{class:"btn btn-esun-outline dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"bi bi-gear me-1"}),o(" 操作選單 ")],-1)),t("ul",$e,[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:I(v=>F(l),["prevent"])},e[31]||(e[31]=[t("i",{class:"bi bi-pencil-square me-1 text-primary"},null,-1),o(" 修改 ")]),8,Ee)]),l.isActive==="Y"?(d(),b("li",Te,[t("a",{class:f(["dropdown-item",{disabled:!l.isActive}]),href:"#",onClick:I(v=>J(l),["prevent"])},e[32]||(e[32]=[t("i",{class:"bi bi-slash-circle me-1 text-warning"},null,-1),o(" 停用 ")]),10,ze)])):k("",!0),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:I(v=>L(l),["prevent"])},e[33]||(e[33]=[t("i",{class:"bi bi-shield-lock me-1 text-success"},null,-1),o(" 產生 Token ")]),8,De)])])])])])]))),128))],2)):(d(),b("div",{key:2,class:f([{"fade-in":a.pageNumber},"active"]),ref:"dataContainer",style:{overflow:"auto"}},[t("table",Ne,[e[39]||(e[39]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"系統代號"),t("th",null,"ApiKey"),t("th",null,"HashKey"),t("th",null,"IVKey"),t("th",null,"是否啟用"),t("th",null,"建立時間"),t("th",null,"更新時間"),t("th",null,"操作選單")])],-1)),t("tbody",null,[(d(!0),b(_,null,R(a.systems,(l,c)=>(d(),b("tr",{key:"".concat(l.system,"-").concat(c)},[t("td",null,i(l.system),1),t("td",null,i(l.apiKey),1),t("td",null,i(l.hashKey),1),t("td",null,i(l.iVKey),1),t("td",null,[t("span",{class:f(l.isActive==="Y"?"text-success":"text-danger")},i(l.isActive==="Y"?"啟用中":"已停用"),3)]),t("td",null,i(T(l.createdTime)),1),t("td",null,i(T(l.lastUpdate)),1),t("td",null,[t("div",Be,[e[38]||(e[38]=t("button",{class:"btn btn-esun-outline dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"bi bi-gear me-1"}),o(" 操作選單 ")],-1)),t("ul",qe,[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:I(v=>F(l),["prevent"])},e[35]||(e[35]=[t("i",{class:"bi bi-pencil-square me-1 text-primary"},null,-1),o(" 修改 ")]),8,Pe)]),l.isActive==="Y"?(d(),b("li",He,[t("a",{class:f(["dropdown-item",{disabled:!l.isActive}]),href:"#",onClick:I(v=>J(l),["prevent"])},e[36]||(e[36]=[t("i",{class:"bi bi-slash-circle me-1 text-warning"},null,-1),o(" 停用 ")]),10,Ge)])):k("",!0),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:I(v=>L(l),["prevent"])},e[37]||(e[37]=[t("i",{class:"bi bi-shield-lock me-1 text-success"},null,-1),o(" 產生 Token ")]),8,Ye)])])])])]))),128))])])],2)),K.value.showModal?(d(),U(Y,{key:3,myModal:K.value,modelValue:q.value,"onUpdate:modelValue":e[10]||(e[10]=l=>q.value=l),onSubmit:le,onCancel:e[11]||(e[11]=l=>K.value.showModal=!1)},null,8,["myModal","modelValue"])):k("",!0),a.totalItems?(d(),U(W,{key:4,modelValue:a.pageNumber,"onUpdate:modelValue":e[12]||(e[12]=l=>a.pageNumber=l),pageSize:a.pageSize,"onUpdate:pageSize":e[13]||(e[13]=l=>a.pageSize=l),"total-items":a.totalItems},null,8,["modelValue","pageSize","total-items"])):k("",!0)]))}}),je=pe(Fe,[["__scopeId","data-v-76aefeaf"]]);export{je as default};
//# sourceMappingURL=SystemListManagement-CtIJ52-x.js.map
