import{d as M,s as S,W as R,w as N,c as s,e as o,f as r,h,z as D,t as p,a2 as O,F as B,A as z,n as E,o as j,_ as q,Q as A,b as G,E as L,x as U}from"./index-tYXX4zXZ.js";const W={class:"mb-3"},J=["for"],P={key:0,class:"text-danger"},H={class:"input-group"},K=["id","name","type","placeholder","disabled","readonly","maxlength","value"],Q=["title"],Y={key:0,class:"form-text text-muted"},X={key:1,style:{"white-space":"pre"},class:"alert_text text-danger"},Z=M({__name:"FormInput",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(C,{emit:F}){var _;const u=C,i=F,g=S((_=u.modelValue)!=null?_:""),e=R(()=>!!(u.field.readonly&&u.field.onClickCallback));N(()=>u.modelValue,m=>{g.value=m!=null?m:""});function t(m){const V=m.target.value,c=u.field.onInputCallback;let b=V;if(c){const v=c(V);typeof v=="string"&&(b=v)}m.target.value=b,g.value=b,i("update:modelValue",b)}function a(m){var c,b;const V=m.target.value;(b=(c=u.field).onChangeCallback)==null||b.call(c,V)}function n(){u.field.readonly&&u.field.onClickCallback&&u.field.onClickCallback()}function y(){var m,V,c,b;g.value="",i("update:modelValue",""),(V=(m=u.field).onClearInput)==null||V.call(m),(b=(c=u.field).onChangeCallback)==null||b.call(c,"")}return(m,V)=>(o(),s("div",W,[r("label",{for:m.field.modelId,class:"form-label"},[D(p(m.field.label)+" ",1),m.field.required===!0?(o(),s("span",P," * ")):h("",!0)],8,J),r("div",H,[r("input",{class:"form-control",autocomplete:"off",id:m.field.modelId,name:m.field.name||m.field.modelId,type:m.field.type||"text",placeholder:m.field.placeholder||"",disabled:m.field.disabled,readonly:m.field.readonly,maxlength:m.field.maxlength,value:g.value,onInput:t,onChange:a,onClick:n,style:O(m.field.readonly&&m.field.onClickCallback?"cursor: pointer;":"")},null,44,K),e.value?(o(),s("button",{key:0,type:"button",class:"btn btn-esun-outline",onClick:y,title:"清除 "+m.field.label},V[0]||(V[0]=[r("i",{class:"bi bi-x-lg"},null,-1)]),8,Q)):h("",!0)]),m.field.hint?(o(),s("small",Y,p(m.field.hint),1)):h("",!0),m.field.error?(o(),s("div",X,p(m.field.error),1)):h("",!0)]))}}),x={class:"mb-3"},ee=["for"],le={key:0,class:"text-danger"},te=["id","disabled","value"],ae={key:0,disabled:"",value:""},oe=["value","disabled","title"],de={key:0,class:"form-text text-muted"},se={key:1,style:{"white-space":"pre"},class:"alert_text text-danger"},ne=M({__name:"FormSelect",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(C,{emit:F}){const u=C,i=F;function g(e){var a,n,y,_;const t=e.target.value;i("update:modelValue",t),(n=(a=u.field).onChangeCallback)==null||n.call(a,t),(_=(y=u.field).onInputCallback)==null||_.call(y,t)}return(e,t)=>(o(),s("div",x,[r("label",{for:e.field.modelId,class:"form-label"},[D(p(e.field.label)+" ",1),e.field.required===!0?(o(),s("span",le," * ")):h("",!0)],8,ee),r("select",{id:e.field.modelId,class:"form-select",disabled:e.field.disabled,value:e.modelValue,onChange:g},[e.field.placeholder?(o(),s("option",ae,p(e.field.placeholder),1)):h("",!0),(o(!0),s(B,null,z(e.field.options,(a,n)=>(o(),s("option",{key:n,value:a.value,disabled:a.disabled,title:a.tooltip},p(a.label),9,oe))),128))],40,te),e.field.hint?(o(),s("small",de,p(e.field.hint),1)):h("",!0),e.field.error?(o(),s("div",se,p(e.field.error),1)):h("",!0)]))}}),ie={class:"mb-3"},re={class:"form-label"},ue={key:0,class:"text-danger"},me=["id","name","value","disabled","title","checked","onChange"],ce=["for"],fe={key:0,class:"form-text text-muted ms-2"},he={key:0,style:{"white-space":"pre"},class:"alert_text text-danger"},pe=M({__name:"FormCheckbox",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(C,{emit:F}){const u=C,i=F;function g(e,t){var y,_,m,V;const a=e.target.checked,n=[...u.modelValue];if(a&&!n.includes(t))n.push(t);else if(!a&&n.includes(t)){const c=n.indexOf(t);n.splice(c,1)}i("update:modelValue",n),(_=(y=u.field).onChangeCallback)==null||_.call(y,n),(V=(m=u.field).onInputCallback)==null||V.call(m,n)}return(e,t)=>(o(),s("div",ie,[r("label",re,[D(p(e.field.label)+" ",1),e.field.required===!0?(o(),s("span",ue," * ")):h("",!0)]),r("div",null,[(o(!0),s(B,null,z(e.field.options,(a,n)=>(o(),s("div",{key:n,class:E(["form-check",e.field.inline?"form-check-inline":""])},[r("input",{class:"form-check-input",type:"checkbox",id:"".concat(e.field.modelId,"_").concat(a.value),name:e.field.name||e.field.modelId,value:a.value,disabled:e.field.disabled||a.disabled,title:a.tooltip,checked:e.modelValue.includes(String(a.value)),onChange:y=>g(y,String(a.value))},null,40,me),r("label",{class:"form-check-label",for:"".concat(e.field.modelId,"_").concat(a.value)},p(a.label),9,ce),a.hint?(o(),s("small",fe,p(a.hint),1)):h("",!0)],2))),128))]),e.field.error?(o(),s("div",he,p(e.field.error),1)):h("",!0)]))}}),be={class:"mb-3"},ve=["for"],ke={key:0,class:"text-danger"},ye={key:0,class:"form-text text-muted"},ge=["id","name","value","disabled","checked"],_e=["for"],Ve={key:0,class:"form-text text-muted ms-2"},$e={key:1,style:{"white-space":"pre"},class:"alert_text text-danger"},Ie=M({__name:"FormRadioGroup",props:{field:{},modelValue:{type:[String,Boolean,Number,null]}},emits:["update:modelValue"],setup(C,{emit:F}){const u=C,i=F;function g(e){var n,y,_,m;const t=e.target.value;let a=t;typeof u.modelValue=="boolean"?a=t==="true":typeof u.modelValue=="number"&&(a=Number(t)),String(a)!==String(u.modelValue)&&(i("update:modelValue",a),(y=(n=u.field).onChangeCallback)==null||y.call(n,a),(m=(_=u.field).onInputCallback)==null||m.call(_,a))}return(e,t)=>(o(),s("div",be,[r("label",{for:e.field.modelId,class:"form-label"},[D(p(e.field.label)+" ",1),e.field.required===!0?(o(),s("span",ke," * ")):h("",!0)],8,ve),e.field.hint?(o(),s("small",ye,p(e.field.hint),1)):h("",!0),r("div",null,[(o(!0),s(B,null,z(e.field.options,(a,n)=>(o(),s("div",{key:n,class:E(["form-check",e.field.inline?"form-check-inline":""])},[r("input",{class:"form-check-input",autocomplete:"off",type:"radio",id:"".concat(e.field.modelId,"_").concat(a.value),name:e.field.name||e.field.modelId,value:a.value,disabled:e.field.disabled||a.disabled,checked:String(e.modelValue)===String(a.value),onChange:g},null,40,ge),r("label",{class:"form-check-label",for:"".concat(e.field.modelId,"_").concat(a.value)},p(a.label),9,_e),a.hint?(o(),s("small",Ve,p(a.hint),1)):h("",!0)],2))),128))]),e.field.error?(o(),s("div",$e,p(e.field.error),1)):h("",!0)]))}}),Ce={class:"mb-3"},Fe=["for"],we={key:0,class:"text-danger"},Se={key:0,class:"form-text text-muted"},Me=["id","placeholder","rows","maxlength","disabled","value"],Ue={key:1,style:{"white-space":"pre"},class:"alert_text text-danger"},Ee=M({__name:"FormTextarea",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(C,{emit:F}){const u=C,i=F;function g(t){const a=t.target.value,n=u.field.onInputCallback;let y=a;if(n){const _=n(a);typeof _=="string"&&(y=_)}t.target.value=y,i("update:modelValue",y)}function e(t){var n,y;const a=t.target.value;(y=(n=u.field).onChangeCallback)==null||y.call(n,a)}return(t,a)=>(o(),s("div",Ce,[r("label",{for:t.field.modelId,class:"form-label"},[D(p(t.field.label)+" ",1),t.field.required===!0?(o(),s("span",we," * ")):h("",!0)],8,Fe),t.field.hint?(o(),s("small",Se,p(t.field.hint),1)):h("",!0),r("textarea",{id:t.field.modelId,class:"form-control",placeholder:t.field.placeholder,rows:t.field.rows,maxlength:t.field.maxlength,disabled:t.field.disabled,value:t.modelValue,onInput:g,onChange:e},null,40,Me),t.field.error?(o(),s("div",Ue,p(t.field.error),1)):h("",!0)]))}}),Be={class:"mb-3"},ze=["for"],De={key:0,class:"text-danger"},Ne=["id","name","accept","multiple","disabled"],qe={key:0,class:"mt-2"},Te={class:"list-unstyled"},Le={class:"text-truncate"},Re=["onClick","disabled"],Oe={key:1,class:"mt-3"},je={class:"row g-2 mt-1"},Ae={class:"position-relative"},Ge=["src","alt","onClick"],We=["onClick","disabled"],Je={class:"text-muted d-block text-truncate mt-1"},Pe={class:"modal-dialog modal-lg modal-dialog-centered"},He={class:"modal-content bg-transparent border-0"},Ke={class:"modal-header border-0 pb-0"},Qe={class:"modal-title text-white"},Ye={class:"modal-body text-center"},Xe=["src","alt"],Ze={key:3,class:"form-text"},xe={key:0},el={key:1},ll={key:2},tl={key:3},al={key:4,class:"invalid-feedback d-block"},ol=M({__name:"FormFile",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(C,{emit:F}){const u=C,i=F,g=S(),e=S([]),t=S([]),a=S(!1),n=S(null);N(()=>u.modelValue,d=>{d?Array.isArray(d)?e.value=[...d]:e.value=[d]:e.value=[],b()},{immediate:!0}),N(()=>e.value,()=>{b()},{deep:!0});function y(d){const $=d.target,I=Array.from($.files||[]),k=_(I);k.length>0&&(u.field.multiple?(e.value=k,i("update:modelValue",k)):(e.value=[k[0]],i("update:modelValue",k[0]))),g.value&&(g.value.value="")}function _(d){const $=[];let I=[];for(const w of d){if(u.field.maxSize&&w.size>u.field.maxSize){I.push('檔案 "'.concat(w.name,'" 超過大小限制 ').concat(f(u.field.maxSize)));continue}if(u.field.accept&&!m(w,u.field.accept)){I.push('檔案 "'.concat(w.name,'" 格式不符合要求'));continue}$.push(w)}const k=e.value.length+$.length;return u.field.maxFiles&&k>u.field.maxFiles?(I.push("最多只能上傳 ".concat(u.field.maxFiles," 個檔案")),[]):(I.length>0?u.field.error=I.join(", "):u.field.error="",$)}function m(d,$){const I=$.split(",").map(k=>k.trim());for(const k of I)if(k.startsWith(".")){if(d.name.toLowerCase().endsWith(k.toLowerCase()))return!0}else if(k.includes("*")){const[w]=k.split("/");if(d.type.startsWith(w))return!0}else if(d.type===k)return!0;return!1}function V(d){e.value.splice(d,1),u.field.multiple?i("update:modelValue",e.value.length>0?e.value:null):i("update:modelValue",null)}function c(d){return d.type.startsWith("image/")}function b(){t.value.forEach(d=>{URL.revokeObjectURL(d.url)}),t.value=[],e.value.forEach((d,$)=>{if(c(d)){const I=URL.createObjectURL(d);t.value.push({url:I,fileName:d.name,index:$})}})}function v(d){n.value=d,a.value=!0}function l(){a.value=!1,n.value=null}j(()=>{t.value.forEach(d=>{URL.revokeObjectURL(d.url)})});function f(d){if(d===0)return"0 B";const $=1024,I=["B","KB","MB","GB"],k=Math.floor(Math.log(d)/Math.log($));return parseFloat((d/Math.pow($,k)).toFixed(2))+" "+I[k]}return(d,$)=>{var I;return o(),s("div",Be,[r("label",{for:d.field.name,class:"form-label"},[D(p(d.field.label)+" ",1),d.field.required?(o(),s("span",De,"*")):h("",!0)],8,ze),r("input",{id:d.field.name,name:d.field.name,type:"file",class:E(["form-control",{"is-invalid":d.field.error}]),accept:d.field.accept,multiple:d.field.multiple,disabled:d.field.disabled,onChange:y,ref_key:"fileInputRef",ref:g},null,42,Ne),e.value.length>0?(o(),s("div",qe,[$[0]||($[0]=r("small",{class:"text-muted"},"已選取的檔案：",-1)),r("ul",Te,[(o(!0),s(B,null,z(e.value,(k,w)=>(o(),s("li",{key:w,class:"d-flex justify-content-between align-items-center"},[r("span",Le,p(k.name)+" ("+p(f(k.size))+") ",1),r("button",{type:"button",class:"btn btn-sm btn-esun-outline-danger ms-2",onClick:T=>V(w),disabled:d.field.disabled}," × ",8,Re)]))),128))])])):h("",!0),t.value.length>0?(o(),s("div",Oe,[$[1]||($[1]=r("small",{class:"text-muted"},"圖片預覽：",-1)),r("div",je,[(o(!0),s(B,null,z(t.value,(k,w)=>(o(),s("div",{key:w,class:"col-6 col-md-4 col-lg-3"},[r("div",Ae,[r("img",{src:k.url,alt:k.fileName,class:"img-thumbnail w-100 preview-image",onClick:T=>v(k)},null,8,Ge),r("button",{type:"button",class:"btn btn-sm btn-danger position-absolute top-0 end-0 rounded-circle",style:{width:"24px",height:"24px",padding:"0",transform:"translate(50%, -50%)"},onClick:T=>V(k.index),disabled:d.field.disabled,title:"移除圖片"}," × ",8,We)]),r("small",Je,p(k.fileName),1)]))),128))])])):h("",!0),a.value?(o(),s("div",{key:2,class:"modal show d-block",tabindex:"-1",onClick:l,style:{"background-color":"rgba(0, 0, 0, 0.8)"}},[r("div",Pe,[r("div",He,[r("div",Ke,[r("h5",Qe,p((I=n.value)==null?void 0:I.fileName),1),r("button",{type:"button",class:"btn-close btn-close-white",onClick:l})]),r("div",Ye,[n.value?(o(),s("img",{key:0,src:n.value.url,alt:n.value.fileName,class:"img-fluid",style:{"max-height":"70vh"}},null,8,Xe)):h("",!0)])])])])):h("",!0),d.field.hint||d.field.accept||d.field.maxSize?(o(),s("div",Ze,[d.field.hint?(o(),s("div",xe,p(d.field.hint),1)):h("",!0),d.field.accept?(o(),s("div",el,"允許的檔案格式: "+p(d.field.accept),1)):h("",!0),d.field.maxSize?(o(),s("div",ll,"檔案大小限制: "+p(f(d.field.maxSize)),1)):h("",!0),d.field.maxFiles?(o(),s("div",tl,"最多可上傳 "+p(d.field.maxFiles)+" 個檔案",1)):h("",!0)])):h("",!0),d.field.error?(o(),s("div",al,p(d.field.error),1)):h("",!0)])}}}),dl=q(ol,[["__scopeId","data-v-ba838661"]]),sl={class:"mb-3"},nl=["for"],il={key:0,class:"text-danger"},rl={key:0,class:"form-text text-muted d-block"},ul=["id","value","disabled","min","max","placeholder"],ml={key:1,class:"invalid-feedback d-block"},cl=M({__name:"FormDatetime",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(C,{emit:F}){const u=C,i=F;function g(t){if(!t)return"";let a;if(typeof t=="string"?a=new Date(t):a=t,isNaN(a.getTime()))return"";const n=a.getFullYear(),y=String(a.getMonth()+1).padStart(2,"0"),_=String(a.getDate()).padStart(2,"0"),m=String(a.getHours()).padStart(2,"0"),V=String(a.getMinutes()).padStart(2,"0");return"".concat(n,"-").concat(y,"-").concat(_,"T").concat(m,":").concat(V)}function e(t){const n=t.target.value;i("update:modelValue",n?new Date(n):null),u.field.onInputCallback&&u.field.onInputCallback(n?new Date(n):null)}return(t,a)=>(o(),s("div",sl,[r("label",{for:t.field.name,class:"form-label"},[D(p(t.field.label)+" ",1),t.field.required?(o(),s("span",il," * ")):h("",!0)],8,nl),t.field.hint?(o(),s("small",rl,p(t.field.hint),1)):h("",!0),r("input",{id:t.field.name,type:"datetime-local",class:E(["form-control",{"is-invalid":t.field.error}]),value:g(t.modelValue),onInput:e,disabled:t.field.disabled,min:t.field.minDate,max:t.field.maxDate,placeholder:t.field.placeholder},null,42,ul),t.field.error?(o(),s("div",ml,p(t.field.error),1)):h("",!0)]))}}),fl=q(cl,[["__scopeId","data-v-57587624"]]),hl=["aria-labelledby","aria-hidden"],pl={class:"modal-content"},bl={class:"modal-header"},vl={class:"modal-title"},kl={class:"modal-body"},yl={class:"container-fluid"},gl={class:"row"},_l={key:0,class:"text-danger"},Vl={class:"modal-footer"},$l=M({__name:"JsonFormModal",props:{myModal:{},modelValue:{}},emits:["update:modelValue","submit","cancel"],setup(C,{expose:F,emit:u}){const i=C,g=u,e=S(""),t=S(!1),a=S([]);A(()=>{t.value=i.myModal.staticBackdrop}),G(()=>{const c=[];i.myModal.fieldGroups.forEach(v=>{v.fields.forEach(l=>{c.push(l.modelId)})});const b=c.filter((v,l,f)=>f.indexOf(v)!==l);if(b.length>0)throw new Error("Duplicate field modelIds: ".concat([...new Set(b)].join(", ")));a.value=i.myModal.fieldGroups.map(v=>({...v,fields:v.fields.map(l=>({...l}))})),i.myModal.fieldGroups.forEach(v=>{v.fields.forEach(l=>{if(!(l.modelId in i.modelValue))switch(l.type){case"checkbox":i.modelValue[l.modelId]=[];break;case"file":i.modelValue[l.modelId]=null;break;case"datetime":i.modelValue[l.modelId]=null;break;default:i.modelValue[l.modelId]=""}l.required===void 0&&(l.required=!0),"inline"in l&&l.inline===void 0&&(l.inline=!0),l.disabled===void 0&&(l.disabled=!1),l.name||(l.name=l.modelId),l.placeholder===void 0&&(l.placeholder=l.label||""),"rows"in l&&l.rows===void 0&&(l.rows=12)})})});function n(c,b){c.onInputCallback&&c.onInputCallback(b),c.error="",e.value=""}function y(c){a.value.forEach(b=>{b.fields.forEach(v=>{v.modelId===c&&(v.error="",a.value.some(f=>f.fields.some(d=>d.modelId!==c&&d.error))||(e.value=""))})})}const _=c=>{c.target===c.currentTarget&&(i.myModal.staticBackdrop?(t.value=!0,setTimeout(()=>{t.value=!1},150)):g("cancel"))};function m(){e.value="";const c=[];if(a.value.forEach(b=>{b.fields.forEach(v=>{v.error="";const l=i.modelValue[v.modelId];if(v.required&&V(l)&&(v.error="請填寫"+v.label+" ! \n",c.push(v)),v.onSubmitCheckCallback){const f=v.onSubmitCheckCallback(l,i.modelValue);f&&(v.error+=f+"\n",e.value+=f+"\n")}})}),c.length>0){e.value="請填寫所有必填欄位",console.warn("Missing fields:",c.map(b=>b.modelId));return}else if(e.value!==""){console.warn("Error fields:",e.value);return}g("update:modelValue",i.modelValue),g("submit",i.modelValue)}function V(c){return c==null||typeof c=="string"&&c.trim()===""||Array.isArray(c)&&c.length===0}return F({clearFieldError:y}),(c,b)=>i.myModal.showModal?(o(),s("div",{key:0,class:E(["modal show d-block",{"static-backdrop-animation":t.value}]),tabindex:"-1","aria-labelledby":i.myModal.modalId,"aria-hidden":!i.myModal.showModal,onClick:_},[r("div",{class:E(["modal-dialog",[c.myModal.size,c.myModal.scrollable?"modal-dialog-scrollable":""]])},[r("div",pl,[r("form",{onSubmit:L(m,["prevent"])},[r("div",bl,[r("h5",vl,p(c.myModal.title),1),r("button",{type:"button",class:"btn-close",onClick:b[0]||(b[0]=v=>c.$emit("cancel"))})]),r("div",kl,[r("div",yl,[r("div",gl,[(o(!0),s(B,null,z(a.value,v=>(o(),s("div",{key:v.title||"default",class:E(v.gridClass)},[(o(!0),s(B,null,z(v.fields,l=>(o(),s("div",{key:l.modelId},[l.type==="text"?(o(),U(Z,{key:0,field:l,modelValue:i.modelValue[l.modelId],"onUpdate:modelValue":[f=>i.modelValue[l.modelId]=f,f=>n(l,f)]},null,8,["field","modelValue","onUpdate:modelValue"])):l.type==="textarea"?(o(),U(Ee,{key:1,field:l,modelValue:i.modelValue[l.modelId],"onUpdate:modelValue":[f=>i.modelValue[l.modelId]=f,f=>n(l,f)]},null,8,["field","modelValue","onUpdate:modelValue"])):l.type==="select"?(o(),U(ne,{key:2,field:l,modelValue:i.modelValue[l.modelId],"onUpdate:modelValue":[f=>i.modelValue[l.modelId]=f,f=>n(l,f)]},null,8,["field","modelValue","onUpdate:modelValue"])):l.type==="checkbox"?(o(),U(pe,{key:3,field:l,modelValue:i.modelValue[l.modelId],"onUpdate:modelValue":[f=>i.modelValue[l.modelId]=f,f=>n(l,f)]},null,8,["field","modelValue","onUpdate:modelValue"])):l.type==="radio"?(o(),U(Ie,{key:4,field:l,modelValue:i.modelValue[l.modelId],"onUpdate:modelValue":[f=>i.modelValue[l.modelId]=f,f=>n(l,f)]},null,8,["field","modelValue","onUpdate:modelValue"])):l.type==="file"?(o(),U(dl,{key:5,field:l,modelValue:i.modelValue[l.modelId],"onUpdate:modelValue":[f=>i.modelValue[l.modelId]=f,f=>n(l,f)]},null,8,["field","modelValue","onUpdate:modelValue"])):l.type==="datetime"?(o(),U(fl,{key:6,field:l,modelValue:i.modelValue[l.modelId],"onUpdate:modelValue":[f=>i.modelValue[l.modelId]=f,f=>n(l,f)]},null,8,["field","modelValue","onUpdate:modelValue"])):h("",!0)]))),128)),b[2]||(b[2]=r("hr",null,null,-1))],2))),128))]),e.value?(o(),s("div",_l,p(e.value),1)):h("",!0)])]),r("div",Vl,[r("button",{class:"btn btn-esun-outline",onClick:b[1]||(b[1]=L(v=>c.$emit("cancel"),["prevent"]))},"取消"),b[3]||(b[3]=r("button",{type:"submit",class:"btn btn-esun-primary"},"確定",-1))])],32)])],2)],10,hl)):h("",!0)}}),Cl=q($l,[["__scopeId","data-v-00c26f72"]]);export{Cl as J};
//# sourceMappingURL=JsonFormModal-D_HC101j.js.map
