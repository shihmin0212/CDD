{"version":3,"file":"SelectListModal-Bg0Ue-Pe.js","sources":["../../src/components/modal/SelectListModal/SelectListModal.vue"],"sourcesContent":["<template>\r\n    <div\r\n        v-if=\"props.myModal.showModal\"\r\n        class=\"modal show d-block\"\r\n        tabindex=\"-1\"\r\n        :aria-labelledby=\"props.myModal.modalId\"\r\n        :aria-hidden=\"!props.myModal.showModal\"\r\n        @click=\"handleBackgroundClick\"\r\n        :class=\"{ 'static-backdrop-animation': animateBackdrop }\"\r\n    >\r\n        <div class=\"modal-dialog\" :class=\"[myModal.size, myModal.scrollable ? 'modal-dialog-scrollable' : '']\">\r\n            <div class=\"modal-content\">\r\n                <form @submit.prevent=\"handleSubmit\">\r\n                    <div class=\"modal-header\">\r\n                        <h5 class=\"modal-title\">{{ props.myModal.title }}</h5>\r\n                        <button type=\"button\" class=\"btn-close\" @click=\"$emit('cancel')\"></button>\r\n                    </div>\r\n                    <div class=\"modal-body\">\r\n                        <div class=\"d-flex mb-2 btn-toolbar justify-content-end mb-3\">\r\n                            <div class=\"btn-group me-2 mb-3\" role=\"group\" aria-label=\"First group\">\r\n                                <!-- 新增搜尋輸入框 -->\r\n                                <div class=\"input-group ms-3\" style=\"max-width: 200px\">\r\n                                    <input type=\"text\" class=\"form-control\" placeholder=\"搜尋\" v-model=\"searchQuery\" />\r\n                                    <div\r\n                                        class=\"btn-close position-absolute end-0 top-50 translate-middle cursor-pointer shadow-none\"\r\n                                        @click=\"clearSearch\"\r\n                                        aria-label=\"清除搜尋\"\r\n                                    >\r\n                                        <button class=\"btn btn-link p-0\" aria-label=\"Close\"></button>\r\n                                    </div>\r\n                                </div>\r\n                                <button type=\"button\" class=\"btn btn-esun-outline\" @click=\"doSearch\">搜尋</button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    class=\"btn btn-esun-outline\"\r\n                                    :class=\"{ active: displayMode === 'card' }\"\r\n                                    @click=\"displayMode = 'card'\"\r\n                                >\r\n                                    卡片顯示\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    class=\"btn btn-esun-outline\"\r\n                                    :class=\"{ active: displayMode === 'table' }\"\r\n                                    @click=\"displayMode = 'table'\"\r\n                                >\r\n                                    表格顯示\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        <div v-if=\"internalSelectedList.length === 0\" class=\"text-muted\">無選取項目</div>\r\n\r\n                        <div v-if=\"displayMode === 'card'\" class=\"d-flex flex-wrap w-100\">\r\n                            <div\r\n                                v-for=\"(item, index) in pagedList\"\r\n                                :key=\"index\"\r\n                                class=\"p-2\"\r\n                                style=\"flex: 1 1 0; min-width: 25%; max-width: 25%; width: 25%\"\r\n                            >\r\n                                <div class=\"card\">\r\n                                    <div\r\n                                        class=\"card-body p-2 d-flex flex-column justify-content-between\"\r\n                                        style=\"height: 100px\"\r\n                                    >\r\n                                        <div class=\"mb-2 text-truncate\" style=\"width: 100%\">{{ item.name }}</div>\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            :data-is-disabled=\"props.disabledDataList?.includes(item.value)\"\r\n                                            v-if=\"props.disabledDataList?.includes(item.value) === false\"\r\n                                            class=\"btn btn-sm btn-danger align-self-end\"\r\n                                            @click=\"onSelectInternal(index)\"\r\n                                        >\r\n                                            選取\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <table v-if=\"displayMode === 'table'\" class=\"table table-bordered\">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>項目</th>\r\n                                    <th>操作</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                <tr v-for=\"(item, index) in pagedList\" :key=\"index\">\r\n                                    <td>{{ item.name }}</td>\r\n                                    <td>\r\n                                        <button\r\n                                            :data-is-disabled=\"props.disabledDataList?.includes(item.value)\"\r\n                                            v-if=\"props.disabledDataList?.includes(item.value) === false\"\r\n                                            type=\"button\"\r\n                                            class=\"btn btn-sm btn-danger\"\r\n                                            @click=\"onSelectInternal(index)\"\r\n                                        >\r\n                                            選取\r\n                                        </button>\r\n                                    </td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n\r\n                        <Pagination\r\n                            v-if=\"totalItems\"\r\n                            v-model:modelValue=\"pageNumber\"\r\n                            v-model:pageSize=\"pageSize\"\r\n                            :total-items=\"totalItems\"\r\n                            :goToPage=\"onPageChangeInternal\"\r\n                        />\r\n                    </div>\r\n                    <div class=\"modal-footer\">\r\n                        <button class=\"btn btn-esun-outline\" @click.prevent=\"$emit('cancel')\">取消</button>\r\n                        <button type=\"submit\" class=\"btn btn-esun-primary\">確定</button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { ref, watchEffect, computed } from 'vue';\r\nimport Pagination from '../../pagination/Pagination.vue';\r\nimport type { MySelectListModal, InternalSelectedList } from './schema';\r\n\r\n// 定義組件接收的屬性，新增 paginationType 可選參數，表示分頁類型（client 或 server）\r\nconst props = defineProps<{\r\n    myModal: MySelectListModal; // 傳入的模態框配置物件\r\n    disabledDataList: string[] | null; // 禁用的項目列表\r\n    selectedList: InternalSelectedList[]; // 已選取的項目列表\r\n    totalItems: number; // 總項目數\r\n    onPageChange?: (searchQuery: string, page: number, pageSize: number) => void; // 分頁變更回調函式\r\n    onSelect: (selected?: any) => void; // 選取項目變更回調函式\r\n    paginationType?: 'client' | 'server'; // 分頁類型，client 端或 server 端\r\n}>();\r\nconst emit = defineEmits<{\r\n    (e: 'update:selectedList', payload: any[]): void; // 更新選取列表事件\r\n    (e: 'update:totalItems', payload: number): void; // 更新總項目數事件\r\n    (e: 'submit'): void; // 提交事件\r\n    (e: 'cancel'): void; // 取消事件\r\n}>();\r\n\r\n// 控制背景動畫狀態\r\nconst animateBackdrop = ref(false);\r\n\r\n// 內部維護搜尋\r\nconst searchQuery = ref('');\r\n\r\n// 內部維護的選取列表，初始為傳入的 selectedList 或空陣列\r\nconst internalSelectedListFullData = ref<InternalSelectedList[]>([]);\r\nconst internalSelectedList = ref<InternalSelectedList[]>([]);\r\n\r\n// 當前頁碼，初始為 1\r\nconst pageNumber = ref(1);\r\n\r\n// 每頁顯示數量，初始為 10\r\nconst pageSize = ref(10);\r\n\r\n// 計算總項目數，為總頁數乘以每頁大小\r\nconst totalItems = ref<number>(props.totalItems);\r\n\r\n// 顯示模式，卡片或表格，預設為卡片\r\nconst displayMode = ref<'card' | 'table'>('card');\r\n\r\n// 計算當前頁面要顯示的項目列表\r\nconst pagedList = computed(() => {\r\n    // 確保使用最新的內部選取列表\r\n    const currentList = internalSelectedList.value || [];\r\n\r\n    if (props.paginationType === 'client') {\r\n        // 客戶端分頁，根據當前頁碼和頁大小切割列表\r\n        const start = (pageNumber.value - 1) * pageSize.value;\r\n        const end = start + pageSize.value;\r\n\r\n        // 確保不會超出陣列範圍\r\n        if (start >= currentList.length) {\r\n            return [];\r\n        }\r\n\r\n        return currentList.slice(start, end);\r\n    } else {\r\n        // 伺服器端分頁，直接返回整個列表\r\n        return currentList;\r\n    }\r\n});\r\n\r\n// 監聽傳入的 selectedList 變化，更新內部選取列表\r\nwatchEffect(() => {\r\n    const newList = props.selectedList || [];\r\n    internalSelectedListFullData.value = [...newList];\r\n    internalSelectedList.value = [...newList];\r\n});\r\n\r\n// 監聽傳入的 totalItems 變化，更新內部總頁數\r\nwatchEffect(() => {\r\n    totalItems.value = props.paginationType === 'client' ? internalSelectedList.value.length : props.totalItems;\r\n    // 客戶端分頁 時，直接返回內部選取列表的長度\r\n});\r\n\r\n// 選定\r\nfunction onSelectInternal(index: number) {\r\n    // 如果有 onSelect 回調，呼叫它\r\n    if (props.onSelect) {\r\n        props.onSelect(internalSelectedList.value[index].value);\r\n    }\r\n}\r\n\r\n// 處理頁碼變更\r\nfunction onPageChangeInternal(page: number, newPageSize: number) {\r\n    pageNumber.value = page;\r\n    pageSize.value = newPageSize;\r\n    // 發出更新總頁數事件\r\n    // emit('update:totalPages', internalTotalPages.value); 在外部組件中處理總頁數更新 再 Props totalPages\r\n    // 如果有 onPageChange 回調，呼叫它\r\n    if (props.onPageChange) {\r\n        props.onPageChange(searchQuery.value, page, newPageSize);\r\n    }\r\n}\r\n\r\n// 處理搜尋\r\nfunction doSearch() {\r\n    if (props.paginationType === 'client') {\r\n        internalSelectedList.value;\r\n    } else {\r\n        if (props.onPageChange) {\r\n            props.onPageChange(searchQuery.value, pageNumber.value, pageSize.value);\r\n        }\r\n    }\r\n}\r\n\r\nfunction clearSearch() {}\r\n\r\n// 處理點擊背景事件，觸發背景動畫\r\nfunction handleBackgroundClick(event: MouseEvent) {\r\n    if (event.target === event.currentTarget) {\r\n        animateBackdrop.value = true;\r\n        setTimeout(() => {\r\n            animateBackdrop.value = false;\r\n        }, 150);\r\n    }\r\n}\r\n\r\n// 處理表單提交事件，發出 submit 事件\r\nfunction handleSubmit() {\r\n    emit('submit');\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.modal {\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n}\r\n.modal-dialog {\r\n    background-color: transparent;\r\n}\r\n\r\n.static-backdrop-animation {\r\n    animation: staticBackdropAnimation 0.15s ease-in-out;\r\n}\r\n\r\n.modal-dialog-scrollable .modal-body {\r\n    max-height: calc(100vh - 200px);\r\n    overflow-y: auto;\r\n}\r\n\r\n@keyframes staticBackdropAnimation {\r\n    0% {\r\n        transform: scale(1);\r\n    }\r\n    50% {\r\n        transform: scale(1.02);\r\n    }\r\n    100% {\r\n        transform: scale(1);\r\n    }\r\n}\r\n</style>\r\n"],"names":["props","__props","emit","__emit","animateBackdrop","ref","searchQuery","internalSelectedListFullData","internalSelectedList","pageNumber","pageSize","totalItems","displayMode","pagedList","computed","currentList","start","end","watchEffect","newList","onSelectInternal","index","onPageChangeInternal","page","newPageSize","doSearch","clearSearch","handleBackgroundClick","event","handleSubmit","_createElementBlock","_normalizeClass","_createElementVNode","myModal","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","$emit","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","$event","_hoisted_9","_openBlock","_hoisted_10","_Fragment","_renderList","item","_hoisted_11","_hoisted_12","_hoisted_13","_a","_b","_hoisted_14","_hoisted_15","_hoisted_16","_createBlock","Pagination","_hoisted_17"],"mappings":"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"}